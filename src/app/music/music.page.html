<ion-content [fullscreen]="true" [scrollY]="true">

    <!-- ============================================ -->
    <!-- SEARCH SECTION CON SUGERENCIAS -->
    <!-- ============================================ -->
    <div class="search-section">
        <ion-searchbar [(ngModel)]="searchTerm" (ionInput)="handleSearch($event)" animated="true"
            placeholder="Buscar canciones, artistas, √°lbumes..." type="search"
            class="custom-searchbar">
        </ion-searchbar>

        <!-- B√∫squedas Populares -->
        <div class="search-suggestions" *ngIf="searchTerm.length === 0 && !isLoading">
            <div class="suggestions-header">
                <h3>üî• B√∫squedas Populares</h3>
            </div>
            <div class="chips-container">
                <ion-chip *ngFor="let search of popularSearches" (click)="quickSearch(search)" color="primary">
                    <ion-icon name="search-outline"></ion-icon>
                    <ion-label>{{ search }}</ion-label>
                </ion-chip>
            </div>
        </div>

        <!-- B√∫squedas Recientes -->
        <div class="recent-searches" *ngIf="recentSearches.length > 0 && searchTerm.length === 0 && !isLoading">
            <div class="suggestions-header">
                <h3>‚è±Ô∏è Recientes</h3>
            </div>
            <div class="chips-container">
                <ion-chip *ngFor="let search of recentSearches" (click)="quickSearch(search)">
                    <ion-icon name="time-outline"></ion-icon>
                    <ion-label>{{ search }}</ion-label>
                    <ion-icon name="close-circle" (click)="removeRecentSearch($event, search)"></ion-icon>
                </ion-chip>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- LOADING STATE -->
    <!-- ============================================ -->
    <div *ngIf="isLoading" class="loader-container">
        <ion-list lines="none">
            <ion-item *ngFor="let item of [1,2,3,4,5,6]" class="song-item skeleton-item">
                <ion-thumbnail slot="start">
                    <ion-skeleton-text animated></ion-skeleton-text>
                </ion-thumbnail>
                <ion-label>
                    <h3><ion-skeleton-text animated class="skeleton-title"></ion-skeleton-text></h3>
                    <p><ion-skeleton-text animated class="skeleton-subtitle"></ion-skeleton-text></p>
                </ion-label>
            </ion-item>
        </ion-list>
    </div>

    <!-- ============================================ -->
    <!-- SONGS LIST -->
    <!-- ============================================ -->
    <div class="songs-container" *ngIf="!isLoading">

        <!-- Empty State -->
        <div *ngIf="tracks.length === 0 && searchTerm.length > 0" class="empty-state">
            <ion-icon name="search-outline"></ion-icon>
            <h2>No encontramos resultados</h2>
            <p>Intenta con otro t√©rmino de b√∫squeda</p>
        </div>

        <div *ngIf="tracks.length === 0 && searchTerm.length === 0" class="empty-state">
            <ion-icon name="musical-notes"></ion-icon>
            <h2>Busca tu m√∫sica favorita</h2>
            <p>Explora millones de canciones</p>
        </div>

        <!-- Results Header -->
        <div class="results-header" *ngIf="tracks.length > 0">
            <h2>{{ tracks.length }} resultados</h2>
            <p>para "{{ searchTerm }}"</p>
        </div>

        <!-- Songs List -->
        <ion-list lines="none" class="songs-list">
            <ion-item *ngFor="let track of tracks; let i = index" class="song-item"
                [class.active]="(currentTrack$ | async)?.id === track.id" [class.no-preview]="!hasPreview(track)"
                (click)="hasPreview(track) ? togglePlay(track) : null">

                <!-- Track Number / Playing Indicator -->
                <div slot="start" class="track-number">
                    <span *ngIf="(currentTrack$ | async)?.id !== track.id" class="number">{{ i + 1 }}</span>
                    <ion-icon *ngIf="(currentTrack$ | async)?.id === track.id && (isPlaying$ | async)" name="pause" class="playing-icon">
                    </ion-icon>
                    <ion-icon *ngIf="(currentTrack$ | async)?.id === track.id && !(isPlaying$ | async)" name="play" class="playing-icon">
                    </ion-icon>
                </div>

                <!-- Album Art -->
                <ion-thumbnail slot="start" class="album-art">
                    <img [src]="track.album_art || track.image || 'assets/default-album.png'" alt="Album">
                    <div class="play-overlay">
                        <ion-icon name="play-circle"></ion-icon>
                    </div>
                </ion-thumbnail>

                <!-- Song Info -->
                <ion-label>
                    <h2 class="track-title">{{ track.title }}</h2>
                    <p class="track-artist">{{ track.artist }}</p>
                </ion-label>

                <!-- Duration & Favorite -->
                <div slot="end" class="actions">
                    <span class="duration" *ngIf="track.duration">{{ formatDuration(track.duration) }}</span>
                    <ion-badge color="medium" *ngIf="!hasPreview(track)">Sin preview</ion-badge>
                    <ion-button (click)="toggleFavorite($event, track)" fill="clear" class="favorite-btn"
                        [class.is-favorite]="isFavorite(track)">
                        <ion-icon [name]="isFavorite(track) ? 'heart' : 'heart-outline'"></ion-icon>
                    </ion-button>
                </div>
            </ion-item>
        </ion-list>
    </div>
</ion-content>
